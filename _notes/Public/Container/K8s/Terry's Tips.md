---
title: Terry's Tips
feed: hide
---
- GCP 쿠베 중요한 것 중 하나가 글로벌 VPC라는 점이다.
	- 아마존 계정마다 하나의 리전만을 갖는데, 구글은 한 프로젝트에서 여러가지 리전을 삽입할 수 있다.
	- 쿠베 클러스터를 여러개의 리전을 걸쳐 만들 수 있다.
		- 글로벌 서비스 구축에 굉장히 편해진다.
	- AWS는 글로벌로 굴릴때 클러스터 한무 복제된다.
	- 로드밸런서도 특정 지점에 생성되는 것이 아닌, 전세계에 배포되고 가장 가까운 곳으로 배포된다.
		- 구글 전용 네트워크 망이라 존나빠르다.
		- AWS는 퍼블릭 망 타고 들어가는거라 그래도 구글보단 느리게 동작한다.
			- 이러한 아키텍처에서의 차이점이 존재한다.


- 컨테이너 죽을때는 여러가지 경우가 발생할 수 있다.
	- 트랜적션 정리 못하고 그냥 죽어버리거나 하면 신나는거다.
	- 그래서 Hook등의 이벤트등을 통해 종료될 때의 시간 지연을 발생시키고 이를 바탕으로 할 수 있다
- autopilot 사용하더라도 모든 설정은 yaml 파일로 생성해주는 것이 좋다.
- 구글 쿠버네티스는 두개의 모드가 있다.
	- 스탠다드는 노드가 관리형 서비스가 아니라, 직접 관리해주어야 한다.
	- 오토 파일럿은 노드 또한 자동 관리형이다.
		- 노드 풀을 관리형 서비스로 들어가서, pod 단위로 관리되어 비용이 절약될 수 있다.
- private cluster의 경우 authorized network만 인바운드를 받을 수 있다.
	- 클러스터에 클라우드 쉘의 포트를 받아줄 수 있도록 포트를 받아주면 된다. [공식 문서](https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#cloud_shell)
	- private cluster를 사용하는 것 자체는 좋은 practice.
- ingress controller가 여러가지 있는데, 뭐 쓸까?
	- 인그레스 컨트롤러는 인그레스 컨트롤러 쓰는게 맞고, 최적화된 걸 쓰면 된다.
	- 구글은 로드 밸런서 붙고, 로컬 환경에는 l7 스위치가 없어서 대안으로 nginx나 프록시같은거 쓰게 되는 것이다.
	- 일반적으로는 ingress controller를 사용해서 해결되는 것이 가장 좋은 상황이다.
		- 클라우드에서는 elb나 attp lb로 자동으로 생성이 된다.
		- 내부적으로 매핑이 되어있다고 할 수 있다.

- 클라우드 코드는 쓰고 있죠?
	- 무조건 쓰세요.
- kubernetes operator 찾아보세요.
	- 쿠버네티스 보면 deployment등 리소스를 정의하도록 할 수 있다.
	- saas등에서 많이 사용한다.
		- 여러개 정의하는 걸 하나로 abstract해준다.
		- 코드를 짜주는게 복잡하고, Golang으로 짜는데 요즘은 [kopf](https://github.com/nolar/kopf)라는거 많이 쓰더라.
	- helm은 꼭 보세요.
- CD를 고민할 때, 클라우드 빌드로 이루어지게 된다.
	- 빌드 자체도 자원을 많이 요구하고, jenkins job을 여러개 두고 인스턴스 크기가 점점 커진다.
	- maker 하나만 도는게 아니라 유닛 테스트까지 돌면 인스턴스 크기가 감당이 안된다.
		- 빌드 머신이 점점 커지게 되고, 한 빌드가 점점 많아지게 된다.
		- 클러스터 유지하는 것도 일이다.
	- 클라우드에 매니지드 서비스로 얹고 이거 클라우드에 돌도록 할 수 있다.
	- 아니면 젠킨스x같은거 써서 쿠버네티스에 job으로 띄우던가...
		- 작은 시스템은 vm 한두대 돌리면 되는데 msa로 나가고 시스템 규모 커지면 분산 시스템 만들어줘야 하는 거다.
		- 클라우드 쓰는게 짱이다.
			- 자원 관리 이쪽에서 알아서 다 해준다.
	- 빌드 과정에서도 재미있는 practice가 많다.
		- 빌드 박살나면 패널티를 주고, 패널티 높아지면 배포 전에 리뷰하는 등의 패널티를 준다.
			- 볼게 되게 많고, SRE의 한 분야로 점점 더 중요해지고 있다.