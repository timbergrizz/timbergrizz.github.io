---
title: Container
feed: hide
---

## 컨테이너

-   일반적인 서버는 하드웨어, 서버, OS 종속성을 포함한다.
-   가상화 돌리면 hypervisor 돌리고, 새롭게 에뮬레이션 하여 커널 돌린다.
    -   여기에 OS 깐다.
    -   Virtual image 내부에 커널이 돌아간다.
        -   VM 밖을 벗어날 수 없다.
    -   Container는 커널 이미지가 원칙적으로는 들어가지 않는다.
        -   OS 의존성과 소스코드로만 돌아갈 수 있도록 하는 것이다.
        -   의존성을 포함하고, 프로세스를 독립시켜 작동시키는 것이다.
        -   그래도 커널은 루트의 커널이다.
            -   다른 OS가 올라가도 커널은 공유하게 된다.
            -   커널을 탈취하면 서버의 커널을 탈취한거다. 서버 뚫린거란 뜻이다.
-   예전에는 컨테이너로 다 소프트웨어 장비 넣는다.
    -   컨테이너 기술 사용하면 최적화 잘되고 벤더 독립성 있다.
    -   화웨이가 커널 탈취해서 트래픽 탈취하는 시나리오가 실제로 발생했다.
-   컨테이너는 하드웨어를 로드하기 위한 자원이 작다.
    -   보안적으로 vm보다 적다.

### 도커의 이미지 구조

-   도커의 이미지는 압축 파일로 구성된다.
    -   랩탑 / 서버라고 치자.
    -   이미지를 설치하면 도커허브에서 이미지를 카피해온다.
        -   이후 extract한다.
        -   이때 같은 이미지를 포함하고 있다면, 동일한 이미지는 같이 사용하다.
    -   레이어 형태로, 이미지를 쌓아가며 새로운 이미지를 만든다.
        -   도커 이미지를 설치하게 되면 서버에 캐싱이 된다.
            -   레이어 단위로 캐싱이 이루어지게 되고, 또 다른 파이썬 앱을 배포할 때 이미지를 재활용할 수 있게 된다.
-   쿠버네티스를 운영할 때, 컨테이너의 uptime을 중요시 해야한다.
    -   빠르게 로드될 수 있어야 한다.
    -   스케일 업을 하는데 존나 오래걸리면 아주 신나는거다.
        -   딥러닝이면 로드하는데만 30분씩 걸리는 신나는거다.
        -   이미지에 모델 자체를 구워놓는 방법이 있다.
    -   로딩 타이밍을 줄이기 위한 여러가지 방법이 있다.
        -   자바 이미지 서빙을 잘하면 300메가 - 못하면 1기가까지 나올 것이다.
    -   베이스 이미지를 생각해서 만드는 것이 빠르고 가볍게 서빙할 수 있게 되는 것이다.
        -   알파인 이미지등을 사용하면 더 빨라지게 되는 것이다.
        -   대부분의 시간은 압축을 푸는데 걸리기만 하는 되는거라, 시간을 아낄 수 있다.
-   자바로 개발하면 jvm 들어가고 스프링 들어가고 하이버네이트 / 서버 들어가게 된다.
    -   이걸 묶어서 배포하는데, 굳이 이걸 묶을 필요가 없다.
        -   도커 컨테이너는 묶여있는 걸 하나의 파일로 본다.
        -   공통되는 부분을 굳이 묶어서 보낼 필요가 없다.
-   도커 파일로 이미지를 만드는데, 요즘은 도커를 잘 안쓴다.
    -   컨테이너 종류가 많은데, 실제 런타임에서는 도커를 잘 사용하지 않는다.
    -   runc / devisor등의 다른 런타임을 사용하게 된다.
        -   이걸 하기 위해서 CRI라는 것을 사용한다.
            -   컨테이너인 척 하기 위해서 지켜야 하는 인터페이스이다.
            -   이러한 API 스펙만 맞추면 된다.
-   도커라이징을 안하고 빌드 타임에 도커 이미지를 만드는 패키지들이 있다.
    -   이런거 쓰면 된다.
    -   우분투 이미지를 지우고 새로운 이미지를 만드는 사람들도 있다.
        -   업데이트 뜨면 신나는거다.